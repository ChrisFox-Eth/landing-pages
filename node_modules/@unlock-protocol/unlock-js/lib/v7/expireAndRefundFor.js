"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _utils = _interopRequireDefault(require("../utils"));

var _constants = require("../constants");

var _erc = require("../erc20");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

async function _default({
  lockAddress,
  keyOwner,
  amount = '0',
  decimals,
  erc20Address
}, callback) {
  const lockContract = await this.getLockContract(lockAddress);

  if (!erc20Address || erc20Address !== _constants.ZERO) {
    erc20Address = await lockContract.tokenAddress();
  } // decimals could be 0!


  if (decimals == null) {
    // get the decimals from the ERC20 contract or default to 18
    if (erc20Address !== _constants.ZERO) {
      decimals = await (0, _erc.getErc20Decimals)(erc20Address, this.provider);
    } else {
      decimals = 18;
    }
  }

  const actualAmount = _utils.default.toDecimal(amount, decimals);

  const transactionPromise = lockContract.expireAndRefundFor(keyOwner, actualAmount);
  const hash = await this._handleMethodCall(transactionPromise);

  if (callback) {
    callback(null, hash);
  }

  await this.provider.waitForTransaction(hash);
  return null;
}