{"ast":null,"code":"import _regeneratorRuntime from\"/Users/chrisfox/git/landing-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/chrisfox/git/landing-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/chrisfox/git/landing-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/chrisfox/git/landing-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/chrisfox/git/landing-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/chrisfox/git/landing-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/chrisfox/git/landing-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import Navbar from'./Navbar';import Main from'./Main';import Web3 from'web3';import'./App.css';var ipfsClient=require('ipfs-http-client');var ipfs=ipfsClient({host:'ipfs.infura.io',port:5001,protocol:'https'});// leaving out the arguments will default to these values\nvar App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.captureFile=function(event){event.preventDefault();var file=event.target.files[0];var reader=new window.FileReader();reader.readAsArrayBuffer(file);reader.onloadend=function(){_this.setState({buffer:Buffer(reader.result),type:file.type,name:file.name});console.log('buffer',_this.state.buffer);};};_this.uploadFile=function(description){console.log(\"Submitting file to IPFS...\");// Add file to the IPFS\nipfs.add(_this.state.buffer,function(error,result){console.log('IPFS result',result.size);if(error){console.error(error);return;}_this.setState({loading:true});// Assign value for the file without extension\nif(_this.state.type===''){_this.setState({type:'none'});}_this.state.dstorage.methods.uploadFile(result[0].hash,result[0].size,_this.state.type,_this.state.name,description).send({from:_this.state.account}).on('transactionHash',function(hash){_this.setState({loading:false,type:null,name:null});window.location.reload();}).on('error',function(e){window.alert('Error');_this.setState({loading:false});});});};_this.state={account:'',dstorage:null,files:[],loading:false,type:null,name:null};_this.uploadFile=_this.uploadFile.bind(_assertThisInitialized(_this));_this.captureFile=_this.captureFile.bind(_assertThisInitialized(_this));return _this;}_createClass(App,[{key:\"componentWillMount\",value:function(){var _componentWillMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.loadWeb3();case 2:_context.next=4;return this.loadBlockchainData();case 4:case\"end\":return _context.stop();}}},_callee,this);}));function componentWillMount(){return _componentWillMount.apply(this,arguments);}return componentWillMount;}()},{key:\"loadWeb3\",value:function(){var _loadWeb=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!window.ethereum){_context2.next=6;break;}window.web3=new Web3(window.ethereum);_context2.next=4;return window.ethereum.enable();case 4:_context2.next=7;break;case 6:if(window.web3){window.web3=new Web3(window.web3.currentProvider);}else{window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!');}case 7:case\"end\":return _context2.stop();}}},_callee2);}));function loadWeb3(){return _loadWeb.apply(this,arguments);}return loadWeb3;}()},{key:\"loadBlockchainData\",value:function(){var _loadBlockchainData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var web3,accounts;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:web3=window.web3;// Load account\n_context3.next=3;return web3.eth.getAccounts();case 3:accounts=_context3.sent;this.setState({account:accounts[0]});case 5:case\"end\":return _context3.stop();}}},_callee3,this);}));function loadBlockchainData(){return _loadBlockchainData.apply(this,arguments);}return loadBlockchainData;}()// Get file from user\n},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Navbar,{account:this.state.account}),this.state.loading?/*#__PURE__*/React.createElement(\"div\",{id:\"loader\",className:\"text-center mt-5\"},/*#__PURE__*/React.createElement(\"p\",null,\"Loading...\")):/*#__PURE__*/React.createElement(Main,{files:this.state.files,captureFile:this.captureFile,uploadFile:this.uploadFile}));}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/chrisfox/git/landing-pages/src/components/App.js"],"names":["React","Component","Navbar","Main","Web3","ipfsClient","require","ipfs","host","port","protocol","App","props","captureFile","event","preventDefault","file","target","files","reader","window","FileReader","readAsArrayBuffer","onloadend","setState","buffer","Buffer","result","type","name","console","log","state","uploadFile","description","add","error","size","loading","dstorage","methods","hash","send","from","account","on","location","reload","e","alert","bind","loadWeb3","loadBlockchainData","ethereum","web3","enable","currentProvider","eth","getAccounts","accounts"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Navbar from './Navbar'\nimport Main from './Main'\nimport Web3 from 'web3';\nimport './App.css';\n\nconst ipfsClient = require('ipfs-http-client')\nconst ipfs = ipfsClient({ host: 'ipfs.infura.io', port: 5001, protocol: 'https' }) // leaving out the arguments will default to these values\n\nclass App extends Component {\n\n  async componentWillMount() {\n    await this.loadWeb3()\n    await this.loadBlockchainData()\n  }\n\n  async loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum)\n      await window.ethereum.enable()\n    }\n    else if (window.web3) {\n      window.web3 = new Web3(window.web3.currentProvider)\n    }\n    else {\n      window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!')\n    }\n  }\n\n  async loadBlockchainData() {\n    const web3 = window.web3\n    // Load account\n    const accounts = await web3.eth.getAccounts()\n    this.setState({ account: accounts[0] })\n\n  }\n\n  // Get file from user\n  captureFile = event => {\n    event.preventDefault()\n\n    const file = event.target.files[0]\n    const reader = new window.FileReader()\n\n    reader.readAsArrayBuffer(file)\n    reader.onloadend = () => {\n      this.setState({\n        buffer: Buffer(reader.result),\n        type: file.type,\n        name: file.name\n      })\n      console.log('buffer', this.state.buffer)\n    }\n  }\n\n  uploadFile = description => {\n    console.log(\"Submitting file to IPFS...\")\n\n    // Add file to the IPFS\n    ipfs.add(this.state.buffer, (error, result) => {\n      console.log('IPFS result', result.size)\n      if(error) {\n        console.error(error)\n        return\n      }\n\n      this.setState({ loading: true })\n      // Assign value for the file without extension\n      if(this.state.type === ''){\n        this.setState({type: 'none'})\n      }\n      this.state.dstorage.methods.uploadFile(result[0].hash, result[0].size, this.state.type, this.state.name, description).send({ from: this.state.account }).on('transactionHash', (hash) => {\n        this.setState({\n         loading: false,\n         type: null,\n         name: null\n       })\n       window.location.reload()\n      }).on('error', (e) =>{\n        window.alert('Error')\n        this.setState({loading: false})\n      })\n    })\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      account: '',\n      dstorage: null,\n      files: [],\n      loading: false,\n      type: null,\n      name: null\n    }\n    this.uploadFile = this.uploadFile.bind(this)\n    this.captureFile = this.captureFile.bind(this)\n  }\n\n  render() {\n    return (\n      <div>\n        <Navbar account={this.state.account} />\n        { this.state.loading\n          ? <div id=\"loader\" className=\"text-center mt-5\"><p>Loading...</p></div>\n          : <Main\n              files={this.state.files}\n              captureFile={this.captureFile}\n              uploadFile={this.uploadFile}\n            />\n        }\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}